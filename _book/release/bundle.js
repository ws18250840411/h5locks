!function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";window.H5lock=function(t){this.height=t.height,this.width=t.width,this.chooseType=Number(window.localStorage.getItem("chooseType"))||t.chooseType},H5lock.prototype.drawCle=function(t,e){this.ctx.strokeStyle="#CFE6FF",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(t,e,this.r,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.stroke()},H5lock.prototype.drawPoint=function(){for(var t=0;t<this.lastPoint.length;t++)this.ctx.fillStyle="#CFE6FF",this.ctx.beginPath(),this.ctx.arc(this.lastPoint[t].x,this.lastPoint[t].y,this.r/2,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill()},H5lock.prototype.drawStatusPoint=function(t){for(var e=0;e<this.lastPoint.length;e++)this.ctx.strokeStyle=t,this.ctx.beginPath(),this.ctx.arc(this.lastPoint[e].x,this.lastPoint[e].y,this.r,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.stroke()},H5lock.prototype.drawLine=function(t,e){this.ctx.beginPath(),this.ctx.lineWidth=3,this.ctx.moveTo(this.lastPoint[0].x,this.lastPoint[0].y),console.log(this.lastPoint.length);for(var i=1;i<this.lastPoint.length;i++)this.ctx.lineTo(this.lastPoint[i].x,this.lastPoint[i].y);this.ctx.lineTo(t.x,t.y),this.ctx.stroke(),this.ctx.closePath()},H5lock.prototype.createCircle=function(){var t=this.chooseType,e=0;this.r=this.ctx.canvas.width/(2+4*t),this.lastPoint=[],this.arr=[],this.restPoint=[];for(var i=this.r,s=0;s<t;s++)for(var o=0;o<t;o++){var n={x:4*o*i+3*i,y:4*s*i+3*i,index:++e};this.arr.push(n),this.restPoint.push(n)}for(this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),s=0;s<this.arr.length;s++)this.drawCle(this.arr[s].x,this.arr[s].y)},H5lock.prototype.getPosition=function(t){var e=t.currentTarget.getBoundingClientRect();return{x:t.touches[0].clientX-e.left,y:t.touches[0].clientY-e.top}},H5lock.prototype.update=function(t){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);for(var e=0;e<this.arr.length;e++)this.drawCle(this.arr[e].x,this.arr[e].y);for(this.drawPoint(this.lastPoint),this.drawLine(t,this.lastPoint),e=0;e<this.restPoint.length;e++)if(Math.abs(t.x-this.restPoint[e].x)<this.r&&Math.abs(t.y-this.restPoint[e].y)<this.r){this.drawPoint(this.restPoint[e].x,this.restPoint[e].y),this.lastPoint.push(this.restPoint[e]),this.restPoint.splice(e,1);break}},H5lock.prototype.checkPass=function(t,e){for(var i="",s="",o=0;o<t.length;o++)i+=t[o].index+t[o].index;for(o=0;o<e.length;o++)s+=e[o].index+e[o].index;return i===s},H5lock.prototype.storePass=function(t){1==this.pswObj.step?this.checkPass(this.pswObj.fpassword,t)?(this.pswObj.step=2,this.pswObj.spassword=t,document.getElementById("title").innerHTML="密码保存成功",this.drawStatusPoint("#2CFF26"),window.localStorage.setItem("passwordxx",JSON.stringify(this.pswObj.spassword)),window.localStorage.setItem("chooseType",this.chooseType)):(document.getElementById("title").innerHTML="两次不一致，重新输入",this.drawStatusPoint("red"),delete this.pswObj.step):2==this.pswObj.step?this.checkPass(this.pswObj.spassword,t)?(document.getElementById("title").innerHTML="解锁成功",this.drawStatusPoint("#2CFF26")):(this.drawStatusPoint("red"),document.getElementById("title").innerHTML="解锁失败"):(this.pswObj.step=1,this.pswObj.fpassword=t,document.getElementById("title").innerHTML="再次输入")},H5lock.prototype.makeState=function(){2==this.pswObj.step?(document.getElementById("updatePassword").style.display="block",document.getElementById("title").innerHTML="请解锁"):(this.pswObj.step,document.getElementById("updatePassword").style.display="none")},H5lock.prototype.setChooseType=function(t){chooseType=t,init()},H5lock.prototype.updatePassword=function(){window.localStorage.removeItem("passwordxx"),window.localStorage.removeItem("chooseType"),this.pswObj={},document.getElementById("title").innerHTML="绘制解锁图案",this.reset()},H5lock.prototype.initDom=function(){var t=document.createElement("div");t.setAttribute("style","position: absolute;top:0;left:0;right:0;bottom:0;"),t.innerHTML='<h4 id="title" class="title">绘制解锁图案</h4><a id="updatePassword" style="position: absolute;right: 5px;top: 5px;color:#fff;font-size: 10px;display:none;">重置密码</a><canvas id="canvas" width="300" height="300" style="display: inline-block;margin-top: 15px;"></canvas>',document.body.appendChild(t)},H5lock.prototype.init=function(){this.initDom(),this.pswObj=window.localStorage.getItem("passwordxx")?{step:2,spassword:JSON.parse(window.localStorage.getItem("passwordxx"))}:{},this.lastPoint=[],this.makeState(),this.touchFlag=!1,this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.createCircle(),this.bindEvent()},H5lock.prototype.reset=function(){this.makeState(),this.createCircle()},H5lock.prototype.bindEvent=function(){var t=this;this.canvas.addEventListener("touchstart",function(e){e.preventDefault();var i=t.getPosition(e);console.log(i);for(var s=0;s<t.arr.length;s++)if(Math.abs(i.x-t.arr[s].x)<t.r&&Math.abs(i.y-t.arr[s].y)<t.r){t.touchFlag=!0,t.drawPoint(t.arr[s].x,t.arr[s].y),t.lastPoint.push(t.arr[s]),t.restPoint.splice(s,1);break}},!1),this.canvas.addEventListener("touchmove",function(e){t.touchFlag&&t.update(t.getPosition(e))},!1),this.canvas.addEventListener("touchend",function(e){t.touchFlag&&(t.touchFlag=!1,t.storePass(t.lastPoint),setTimeout(function(){t.reset()},300))},!1),document.addEventListener("touchmove",function(t){t.preventDefault()},!1),document.getElementById("updatePassword").addEventListener("click",function(){t.updatePassword()})}}]);